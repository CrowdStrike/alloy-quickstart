# foundry-sandbox

ðŸ‘‹ This is Evan Stoner's personal reference, template, and playground for working with Foundry apps.

## UI (extensions and pages)

Unlike the content generated by the Foundry CLI, which creates a new NPM project for every extension and page, we create a single NPM project for _all_ extensions and pages:

```
ui/
  public/
    index.html        Template for all built HTML files (entrypoint for extensions and pages)
  src/
    components/       React components reusable across all pages and extensions
      PatternflyShim  Imports PatternFly styles and handles light/dark theme
      ConsoleExtension  Extension into an existing Falcon page (includes PatternflyShim)
      ConsolePage     Full UI page (includes PatternflyShim)
    lib/
      foundry-context React-ified usage of foundry-js
    pages/            (optional) Single-page app to provide all pages
    extensions/       (optional) Contains a subdirectory for each extension (each is a separate app)
```

At build time, a separate HTML file and JavaScript bundle is created for `pages`, and each extension.

### Reusable components

- `PatternflyShim` - Just imports the PatternFly CSS so that you can use [any PatternFly component](https://www.patternfly.org/components/all-components) in your app. Also handles light/dark mode switching so the extension or page matches the Falcon console.
- `ConsoleExtension` - Extension into an existing Falcon page, e.g detection details pane. Applies some necessary styling.
- `ConsolePage` - A full page in the Falcon console, potentially with Falcon navigation.

Both `ConsoleExtension` and `ConsolePage` include `PatternflyShim`.

### Reusable libraries

`foudry-context` is a React-ified wrapper of foundry-js:

- `FoundryContext` - A React context containing the `falcon` object and `data` associated with the extension or page. The `data` is the same as `falcon.data`, but wrapped in a `useState` (and also automatically updated through `falcon.events.on('data')`).
- `FoundryProvider` - Every context has to have a provider. This is where we create the `falcon` object, `connect()` it, and handle other setup.
- `useFoundry` - A custom hook that loads the `FoundryContext` (must be used within a `FoundryProvider`). Use this hook instead of manually calling `useContext(FoundryContext)`.

### Example usage

For any page or extension, wrap the `<App />` in a `<FoundryProvider>` in the `index.tsx`:

```jsx
// src/pages/index.tsx
root.render(
  <React.StrictMode>
    <FoundryProvider>
      <App />
    </FoundryProvider>
  </React.StrictMode>
);
```

Then in the `App.tsx`, wrap your content in either a `<ConsoleExtension>` or `<ConsolePage>`:

```jsx
// src/pages/App.tsx
return (
  <ConsolePage>
    <Title headingLevel="h1">Sandbox</Title>
  </ConsolePage>
);
```

Since you wrapped everything in a `FalconProvider`, you're also free to `useFoundry` to get the `falcon` and/or `data` objects (you can do this in your `App.tsx`, or anywhere else):

```jsx
// src/extensions/detection-details/App.tsx
const { data, isInitialized } = useFoundry();

// ... snip: activeTabKey and handleTabClick setup ...

return (
  <ConsoleExtension>
    <Tabs activeKey={activeTabKey} onSelect={handleTabClick}>
      <Tab title={<TabTitleText>Home</TabTitleText>} eventKey="home">
        <Home detection={data!.detection} />
      </Tab>
```
